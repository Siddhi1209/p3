#!/usr/bin/ksh
out_file=/home/monitorp/newpace/data
mdf=`cut -c 9-16 $data/file/MFLAGS`
cur_date=`date | cut -c5-10`
>${out_file}/req_job_status.txt
if [ -s /home/monitorp/newpace/scripts/ONLINE/REQ_JOB_LIST.card ]
then
        cat /home/monitorp/newpace/scripts/ONLINE/REQ_JOB_LIST.card | grep -v '^#' | while read line
        do
                i=`echo ${line} | awk -F ',' '{print $1}'`
                job_flag=`echo ${line} | awk -F ',' '{print $2}'`
                log_check_flag=`echo ${line} | awk -F ',' '{print $3}'`
                if [ "${job_flag}" = "Y" ]
                then
                        job_check=`ps -fu fnsonlid | grep -w ${i} | grep -Ev 'grep|vim'`
                        if [ $? -eq 1 ]
                        then
                                if [ ${log_check_flag} = "Y" ]
                                then

                                        if [ ! -f $sysout/${i}* ]
                                        then
                                                echo "`hostname`,${i},NR" >>${out_file}/req_job_status.txt
                                        else
                                                file_name=`ls -lrt $sysout/${i}* grep "${cur_date}" | tail -1 | awk '{print $NF}'`
                                                check_rc=`grep 'RC =' ${file_name} | grep -i end | awk '{print $NF}' | tail -1`
                                                if [ ${check_rc} -eq 0 ]
                                                then
                                                        ps -fu fnsonlid | grep -w ${i} | grep -Ev 'grep|vim'
                                                        if [ $? -eq 1 ]
                                                        then
                                                                echo "`hostname`,${i},NR" >>${out_file}/req_job_status.txt
                                                        else
                                                                echo "`hostname`,${i},RU" >>${out_file}/req_job_status.txt
                                                        fi
                                                else
                                                        echo "`hostname`,${i},CR" >>${out_file}/req_job_status.txt
                                                fi
                                        fi
                                else
                                        echo "`hostname`,${i},NR" >>${out_file}/req_job_status.txt
                                fi
                        else
                                if [ ${log_check_flag} = "Y" ]
                                then
                                        file_time=`ll -rtl $sysout/${i}* | grep "${cur_date}" | tail -1 | awk '{print $8}'`
                                        curr_time=`date | awk '{print $4}' | cut -c 1-5`
                                        tim_diff=`$npscripts/UTILITIES/getTimeDiff.pl $file_time $curr_time`
                                        if [ ${tim_diff} -gt 60 ]
                                        then
                                                echo "`hostname`,${i},NU" >>${out_file}/req_job_status.txt
                                        else
                                                echo "`hostname`,${i},RU" >>${out_file}/req_job_status.txt
                                        fi
                                else
                                        echo "`hostname`,${i},RU" >>${out_file}/req_job_status.txt
                                fi
                        fi
                fi
        done
else
        echo "`hostname`,NANA - No entry in Cardfile" >>${out_file}/req_job_status.txt
fi
################################################### SY1000  ##################################################                      [BY CHINMAY]

out_file=/home/monitorp/newpace/data
cur_date=`date | cut -c5-10`
file_name=`ls -lrt $sysout/SY1000_???*out | grep "${cur_date}" | head -1 | awk '{print $NF}'`
x=""

check_rc=`grep 'RC =' ${file_name} | grep -i end | awk '{print $NF}' | tail -1`
if [  ${check_rc} -eq ${x} ]
then
check_rc=0
fi
rcode=`grep 'RETURN CODE' ${file_name} | awk '{print $5}'`
if [  ${rcode} -eq ${x} ]
then
rcode=0
fi
if [ ${check_rc} -eq 0 ] && [ ${rcode} -eq 0 ]
then
        ps -fu fnsonlid | grep -w SY1000 | grep -Ev 'grep|vim'
        if [ $? -eq 1 ]
        then
        echo "`hostname`,SY1000,NR" >> ${out_file}/req_job_status.txt
        else
        echo "`hostname`,SY1000,RU" >> ${out_file}/req_job_status.txt
        fi
else
        echo "`hostname`,SY1000,CR" >> ${out_file}/req_job_status.txt
fi

#################################################################################################################
$npscripts/UTILITIES/ftc_onl.sh ${out_file}/req_job_status.txt  req_job_status_m.txt_${mdf}
$npscripts/UTILITIES/ftc_onl.sh ${out_file}/NT000_file_status.txt NT000_file_status.txt_${mdf}
$npscripts/UTILITIES/ftc_onl.sh $HOME/pace/space_check_median.txt space_check_median.txt
$npscripts/UTILITIES/ftc_onl.sh $HOME/pace/TBforward_status.txt TBforward_status.txt


##################################### DCOG SERVER APPLICATION LOG MOUNTPOINT SPACE CHECK ##################################
nar_ip=`grep DCOG1 /opt/TouchBase/config/officedbsbi.txt | awk -F 'ftphost=' '{print $2}' | awk -F '|' '{print $1}'`
nar_user=`grep DCOG1 /opt/TouchBase/config/officedbsbi.txt | awk -F 'user=' '{print $2}' | awk -F '|' '{print $1}'`
nar_port=`grep DCOG1 /opt/TouchBase/config/officedbsbi.txt | awk -F 'sport=' '{print $2}' | awk -F '|' '{print $1}'`

mul_ip=`grep DCOGDR /opt/TouchBase/config/officedbsbi.txt | awk -F 'ftphost=' '{print $2}' | awk -F '|' '{print $1}'`
HIMALAYA:/home/monitorp/newpace/scripts/ONLINE:-)
HIMALAYA:/home/monitorp/newpace/scripts/ONLINE:-)
HIMALAYA:/home/monitorp/newpace/scripts/ONLINE:-)
HIMALAYA:/home/monitorp/newpace/scripts/ONLINE:-)cat online_requested_job_check.sh
#!/usr/bin/ksh
out_file=/home/monitorp/newpace/data
mdf=`cut -c 9-16 $data/file/MFLAGS`
cur_date=`date | cut -c5-10`
>${out_file}/req_job_status.txt
if [ -s /home/monitorp/newpace/scripts/ONLINE/REQ_JOB_LIST.card ]
then
        cat /home/monitorp/newpace/scripts/ONLINE/REQ_JOB_LIST.card | grep -v '^#' | while read line
        do
                i=`echo ${line} | awk -F ',' '{print $1}'`
                job_flag=`echo ${line} | awk -F ',' '{print $2}'`
                log_check_flag=`echo ${line} | awk -F ',' '{print $3}'`
                if [ "${job_flag}" = "Y" ]
                then
                        job_check=`ps -fu fnsonlid | grep -w ${i} | grep -Ev 'grep|vim'`
                        if [ $? -eq 1 ]
                        then
                                if [ ${log_check_flag} = "Y" ]
                                then

                                        if [ ! -f $sysout/${i}* ]
                                        then
                                                echo "`hostname`,${i},NR" >>${out_file}/req_job_status.txt
                                        else
                                                file_name=`ls -lrt $sysout/${i}* grep "${cur_date}" | tail -1 | awk '{print $NF}'`
                                                check_rc=`grep 'RC =' ${file_name} | grep -i end | awk '{print $NF}' | tail -1`
                                                if [ ${check_rc} -eq 0 ]
                                                then
                                                        ps -fu fnsonlid | grep -w ${i} | grep -Ev 'grep|vim'
                                                        if [ $? -eq 1 ]
                                                        then
                                                                echo "`hostname`,${i},NR" >>${out_file}/req_job_status.txt
                                                        else
                                                                echo "`hostname`,${i},RU" >>${out_file}/req_job_status.txt
                                                        fi
                                                else
                                                        echo "`hostname`,${i},CR" >>${out_file}/req_job_status.txt
                                                fi
                                        fi
                                else
                                        echo "`hostname`,${i},NR" >>${out_file}/req_job_status.txt
                                fi
                        else
                                if [ ${log_check_flag} = "Y" ]
                                then
                                        file_time=`ll -rtl $sysout/${i}* | grep "${cur_date}" | tail -1 | awk '{print $8}'`
                                        curr_time=`date | awk '{print $4}' | cut -c 1-5`
                                        tim_diff=`$npscripts/UTILITIES/getTimeDiff.pl $file_time $curr_time`
                                        if [ ${tim_diff} -gt 60 ]
                                        then
                                                echo "`hostname`,${i},NU" >>${out_file}/req_job_status.txt
                                        else
                                                echo "`hostname`,${i},RU" >>${out_file}/req_job_status.txt
                                        fi
                                else
                                        echo "`hostname`,${i},RU" >>${out_file}/req_job_status.txt
                                fi
                        fi
                fi
        done
else
        echo "`hostname`,NANA - No entry in Cardfile" >>${out_file}/req_job_status.txt
fi
################################################### SY1000  ##################################################                      [BY CHINMAY]

out_file=/home/monitorp/newpace/data
cur_date=`date | cut -c5-10`
file_name=`ls -lrt $sysout/SY1000_???*out | grep "${cur_date}" | head -1 | awk '{print $NF}'`
x=""

check_rc=`grep 'RC =' ${file_name} | grep -i end | awk '{print $NF}' | tail -1`
if [  ${check_rc} -eq ${x} ]
then
check_rc=0
fi
rcode=`grep 'RETURN CODE' ${file_name} | awk '{print $5}'`
if [  ${rcode} -eq ${x} ]
then
rcode=0
fi
if [ ${check_rc} -eq 0 ] && [ ${rcode} -eq 0 ]
then
        ps -fu fnsonlid | grep -w SY1000 | grep -Ev 'grep|vim'
        if [ $? -eq 1 ]
        then
        echo "`hostname`,SY1000,NR" >> ${out_file}/req_job_status.txt
        else
        echo "`hostname`,SY1000,RU" >> ${out_file}/req_job_status.txt
        fi
else
        echo "`hostname`,SY1000,CR" >> ${out_file}/req_job_status.txt
fi

#################################################################################################################
$npscripts/UTILITIES/ftc_onl.sh ${out_file}/req_job_status.txt  req_job_status_m.txt_${mdf}
$npscripts/UTILITIES/ftc_onl.sh ${out_file}/NT000_file_status.txt NT000_file_status.txt_${mdf}
$npscripts/UTILITIES/ftc_onl.sh $HOME/pace/space_check_median.txt space_check_median.txt
$npscripts/UTILITIES/ftc_onl.sh $HOME/pace/TBforward_status.txt TBforward_status.txt


##################################### DCOG SERVER APPLICATION LOG MOUNTPOINT SPACE CHECK ##################################
nar_ip=`grep DCOG1 /opt/TouchBase/config/officedbsbi.txt | awk -F 'ftphost=' '{print $2}' | awk -F '|' '{print $1}'`
nar_user=`grep DCOG1 /opt/TouchBase/config/officedbsbi.txt | awk -F 'user=' '{print $2}' | awk -F '|' '{print $1}'`
nar_port=`grep DCOG1 /opt/TouchBase/config/officedbsbi.txt | awk -F 'sport=' '{print $2}' | awk -F '|' '{print $1}'`

mul_ip=`grep DCOGDR /opt/TouchBase/config/officedbsbi.txt | awk -F 'ftphost=' '{print $2}' | awk -F '|' '{print $1}'`
mul_user=`grep DCOGDR /opt/TouchBase/config/officedbsbi.txt | awk -F 'user=' '{print $2}' | awk -F '|' '{print $1}'`
mul_port=`grep DCOGDR /opt/TouchBase/config/officedbsbi.txt | awk -F 'sport=' '{print $2}' | awk -F '|' '{print $1}'`

ssh -oPort=${nar_port} ${nar_user}@${nar_ip} "bdf | grep -E '/sbi_report_data/ftp/stage|/Application_log' | grep "%" | awk '{print \$4" "\$5}'" >${out_file}/narmada_sp_chk.log
ssh -oPort=${nar_port} ${nar_user}@${nar_ip} "bdf | grep -E '/var' | grep "%" | awk '{print "\$5" "\$6"}'" >>${out_file}/narmada_sp_chk.log

#newmountpointadd=`ssh -oPort=${nar_port} ${nar_user}@${nar_ip} "bdf | grep -w '/sbi_report_data'| grep "%" | awk '{print $4" "$5}'|head -1"`
#ssh -oPort=2322 rptftp@10.0.40.4 bdf | grep -w '/sbi_report_data'| grep "%" | awk '{print \$4" "\$5}'" | head -1>>${out_file}/narmada_sp_chk.log
ssh -oPort=${mul_port} ${mul_user}@${mul_ip} "bdf | grep -E '/sbi_report_data/ftp/stage|/Application_log' | grep "%" | awk '{print \$4" "\$5}'" >${out_file}/mulai_sp_chk.log
>${out_file}/dcog_srvr_spa_ut_chk.log
val=`ssh -oPort=${nar_port} ${nar_user}@${nar_ip} "bdf | grep -w '/sbi_report_data'| grep "%" |head -1 "`
valawk=`echo $val|awk '{print \$4" "\$5}'`
echo "narmada,$valawk">>${out_file}/dcog_srvr_spa_ut_chk.log

val=`ssh -oPort=${nar_port} ${nar_user}@${nar_ip} "bdf | grep -w '/var'| grep "%" |head -1 "`
valawk=`echo $val|awk '{print \$5" "\$6}'`
echo "narmada,$valawk">>${out_file}/dcog_srvr_spa_ut_chk.log

for i in narmada mulai
do
        mon=`cut -c 9-14 $data/file/MFLAGS`
        for j in Application_log ${mon}
        do
                sp_chk=`grep "${j}" ${out_file}/${i}_sp_chk.log`
                echo "${i},${sp_chk}" >>${out_file}/dcog_srvr_spa_ut_chk.log
        done
done
mv ${out_file}/dcog_srvr_spa_ut_chk.log ${out_file}/dcog_server_space_utilisation_check.log
$npscripts/UTILITIES/ftc_onl.sh ${out_file}/dcog_server_space_utilisation_check.log dcog_server_space_utilisation_check.log
